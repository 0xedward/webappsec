<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>User Interface Directives for Content Security Policy</title>
  <link href="../default.css" rel="stylesheet" type="text/css">
<style>
  body {
    background: url("https://www.w3.org/StyleSheets/TR/logo-ED") top left no-repeat white;
    background-attachment: fixed;
    color: black;
    font-family: sans-serif;
    margin: 0 auto;
    max-width: 50em;
    padding: 2em 1em 2em 70px;
  }
  :link { color: #00C; background: transparent }
  :visited { color: #609; background: transparent }
  a[href]:active { color: #C00; background: transparent }
  a[href]:hover { background: #ffa }

  a[href] img { border-style: none }

  h1, h2, h3, h4, h5, h6 { text-align: left }
  h1, h2, h3 { color: #005A9C; }
  h1 { font: 170% sans-serif }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  h4 { font: bold 100% sans-serif }
  h5 { font: italic 100% sans-serif }
  h6 { font: small-caps 100% sans-serif }

  .hide { display: none }

  div.head { margin-bottom: 1em }
  div.head h1 { margin-top: 2em; clear: both }
  div.head table { margin-left: 2em; margin-top: 2em }

  p.copyright { font-size: small }
  p.copyright small { font-size: small }

  pre { margin-left: 2em }
  dt { font-weight: bold }

  ul.toc, ol.toc {
    list-style: none;
  }
  </style>
  <meta content="Bikeshed 1.0.0" name="generator">
 </head>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="http://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home" width="72"> </a></p>
   <h1 class="p-name no-ref" id="title">User Interface Directives for Content Security Policy</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2015-08-24">24 August 2015</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/webappsec/specs/uisecurity/">https://w3c.github.io/webappsec/specs/uisecurity/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5BUI Security%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line “<kbd>[UI Security] <var>… message topic …</var></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:hillbrad@fb.com">Brad Hill</a> (<span class="p-org org">Facebook</span>)
     <dt>Author:
     <dd><span>Dan Kaminsky, Invited Expert</span>
     <dd><span>David Lin-Shung Huang, Carnegie Mellon University</span>
     <dd><span>Giorgio Maone, Invited Expert</span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2015 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>UI Security defines directives for Content Security Policy

to specify input protections for a web resource’s to protect
against "UI Redressing" attacks, of which "clickjacking" is one.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p><strong>Changes to this document may be tracked at <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong></p>
   <p> The (<a href="http://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list <a href="mailto:public-webappsec@w3.org?Subject=%5BUI Security%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a> (see <a href="http://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “UI Security” in the subject,
	preferably like this:
	“[UI Security] <em>…summary of comment…</em>” </p>
   <p> This document was produced by the <a href="http://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>. </p>
   <p> This document was produced by a group operating under
	the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="http://www.w3.org/2014/Process-20140801/" id="w3c_process_revision">1 August 2014 W3C Process Document</a>. </p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>
  <div data-fill-with="table-of-contents" role="navigation">
   <ul class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#additional_conformance"><span class="secno">2</span> <span class="content">Additional Conformance Notes</span></a>
    <li>
     <a href="#sec-directives"><span class="secno">3</span> <span class="content">Directives</span></a>
     <ul class="toc">
      <li><a href="#input_protection"><span class="secno">3.1</span> <span class="content"><code>input-protection</code></span></a>
     </ul>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ul class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
      <li><a href="#conformance-classes"><span class="secno"></span> <span class="content">Conformance Classes</span></a>
     </ul>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ul class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </ul>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ul class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ul>
   </ul>
  </div>
  <main>
   <section>
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <p><em>This section is not normative.</em></p>
    <p>This document defines User Interface Security directives
    for Content Security Policy, a mechanism web applications
    can use to mitigate some of the risks of
    User Interface (UI) Redressing UIREDRESS
    (AKA "Clickjacking") vulnerabilities that can lead to fraudulent
    actions not intended by the user.</p>
    <p>Content Security Policy (CSP) is a declarative policy that
    lets the authors (or server administrators) of a web application
    restrict the behavior of a document, e.g.  the origins where it can
    load its resources from or the ways it can execute scripts.  This
    document defines new directives for CSP to restrict the presentation
    and/or the interactivity of a resource when its interaction with the
    user may be happening in an ambiguous or deceitful context due to the
    spatial and/or temporal contiguity with other content displayed by the
    user agent.</p>
    <p>In some UI Redressing attacks (also known as Clickjacking), a malicious web
    application presents a user interface of another web application in a
    manipulated context to the user, e.g. by partially obscuring the genuine
    user interface with opaque layers on top, hence tricking the user to click
    on a button out of context.</p>
    <p>Existing anti-clickjacking measures including frame-busting FRAMEBUSTING
    code and <code>X-Frame-Options</code> cannot be used to protect resources where
    the set of origins that should be allowed and disallowed is unknown, where
    attacks might come from origins intended to be allowed by a use scenario,
    or defend against timing-based attacks involving multiple windows instead
    of multiple frames.  Frame-busting scripts also rely on browser behavior
    that has not been engineered to provide a security guarantee.  As a
    consequence, such scripts may be unreliable if loaded inside a sandbox
    or otherwise disabled.</p>
    <p>The User Interface Security directives provide a new mechanism to allow web
    applications to enable heuristic input protections for its user interface.
    To mitigate UI redressing, for example, a web application can request that
    a user interface element should be fully visible for a minimum period of
    time before a user input can be delivered.</p>
    <p>The User Interface Security directive can often be applied to existing
    applications with few or no changes, but the heuristic hints supplied by
    the policy may require considerable experimental fine-tuning to achieve
    an acceptable error rate.</p>
    <p>A user agent that understands the directives in this document should
    ignore the <code>X-Frame-Options</code> header, when present, if User
    Interface Security directives are also present in a
    Content-Security-Policy header. This is to allow resources to only be
    embedded if the mechanisms described in this specification are enforced,
    and more restrictive <code>X-Frame-Options</code> policies applied
    in non-conformant user agents. TODO: how to interact with frame-ancestors?</p>
    <p>A user agent may implement the core directives of CSP independently
    from the directives in this specification, but this specification requires
    the policy conveyance and reporting mechanisms described in CSP.  The
    interpretation of terms imported into this document from CSP may vary
    depending on the level implemented by the user agent.  For example,
    a <code>source-expression</code> in Content Security Policy Level 1 is
    at the granularity of an <code>origin</code><a data-link-type="biblio" href="#biblio-origin">[ORIGIN]</a> but may be
    more granular in higher conformance levels.</p>
    <p></p>
    <p>Application authors should transmit the directives in this specification
    as part of a single, complete Content Security Policy, as indicated by
    that specification.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="additional_conformance"><span class="secno">2. </span><span class="content">Additional Conformance Notes</span><a class="self-link" href="#additional_conformance"></a></h2>
    <p><em>This section is not normative.</em></p>
    <p>UI Redressing attacks rely on fooling the subjective perceptions of
    human actors to induce them to interact with a web application out of
    its intended context.  Because of this, the specific mechanisms which
    may be used in attack and defense may vary greatly with the details of
    a user agent implementation.  For example, attacks which rely on
    redressing the cursor may not apply in a touch environment, or entire
    classes of attack may be impossible on a text-only browser or screen
    reader.</p>
    <p>Similarly, the implementation of the policies specified herein is highly
    dependent on internal architecture and implementation strategies of
    the user agent; such strategies may vary greatly between user agents
    or even across versions of a single user agent.</p>
    <p>This specification provides a normative means by which a resource
    owner can communicate to a user agent its desire for additional
    protective measures, actions to take if violations are detected,
    and tuning hints which may be useful for certain means of
    implementation.</p>
    <p>A user agent is conformant if it understands these directives and
    makes a best effort to provide the desired security properties.
    This might include doing nothing, e.g. in the case of a screen
    reader that does not support embedded resources in a manner
    subject to any of the attack classes of concern.</p>
    <p>While the indeterminacy of the user agent implementation protects
    applications from needing to constantly update their policies as
    user agents make internal changes, application authors should
    understand that even a conformant user agent cannot make
    perfect security guarantees against UI Redressing.
    Some potential checks suggested here might not be made as a
    consequence of implementation strategies, or to avoid unacceptable
    performance costs, and the intrepretation of policies
    might differ among user agents. (e.g. a tolerance hint may appy
    strictly to rectangular clipping in one implementation but
    to pixel or sub-pixel comparisions in another)</p>
    <p>These directives should be used as part of a comprehensive risk
    mitigation strategy with an appropriate understanding of their
    limitations.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="sec-directives"><span class="secno">3. </span><span class="content">Directives</span><a class="self-link" href="#sec-directives"></a></h2>
    <p>This section describes the content security policy
    directives introduced in this specification.</p>
    <section id="input-protection">
     <h3 class="heading settled" data-level="3.1" id="input_protection"><span class="secno">3.1. </span><span class="content"><code>input-protection</code></span><a class="self-link" href="#input_protection"></a></h3>
     <p>The <code>input-protection</code> directive, if present or
        implied, instructs the user agent to apply the heuristic UI
        redressing protections described in the Input
        Protection Heuristic section to user input events, such as <code>click</code>, <code>keypress</code>, <code>touch</code>, and <code>drag</code>, before they are delivered to the resource.</p>
     <p>The screenshot comparison heuristic, in particular, uses the
        body-bounding rectangle of the document triggering the event as
        its default reference area, or the rectangle defined by the <code>input-protection-clip</code> and by the <code>input-protection-selectors</code> directives if any of
        those is explicitly set.</p>
     <p>If the <code>input-protection-clip</code> directive is set as
        part of a <code>Content-Security-Policy</code>, triggering of
        the heuristic should cancel delivery of the UI event to the
        target and cause a violation report to be sent.  If set as
        part of a <code>Content-Security-Policy-Report-Only</code>,
        triggering of the heuristic should result in the event being
        delivered with the <code>unsafe</code> attribute on the <code>UIEvent</code> set to <code>true</code> and cause a violation report to be sent.</p>
     <p>The optional directive value allows resource authors to
        provide <a href="#input-protection-options">options</a> for heuristic tuning in the form of space-separated <code>option-name=option-value</code> pairs.</p>
<pre>directive-name    = "input-protection"
directive-value   = ["display-time=" num-val] ["tolerance=" num-val]
</pre>
     <p>If the policy does not contain a value for this directive
        or any of the hint name=value pairs are absent, the user
        agent SHOULD apply default values for hints as described
        in the following.</p>
     <dl id="input-protection-options">
      <dt><code>display-time</code>
      <dd>
        is a numeric value from 0 to 10000 that specifies how long, in
                milliseconds, the screen area containing the protected user
                interface must have been displayed continuously unchanged
                when the event is processed. 
       <p>If not specified, it defaults to 800. If a value out of the
                range stated above is specified, it defaults to the nearest
                value between the lower and the higher bounds.</p>
      <dt><code>tolerance</code>
      <dd> is a numeric value from 0 to 99 that defines the difference
                threshold at which the screenshot comparison procedure of the
                input protection heuristic triggers a violation. A value of 0
                indicates that no difference between the two images is
                permitted. A value of 99 provides little to no
                practical protection. If not specified, it defaults to 0. 
     </dl>
    </section>
   </section>
  </main>
  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="example-f839f6c8">
   <a class="self-link" href="#example-f839f6c8"></a>
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
  <h3 class="no-ref no-num heading settled" id="conformance-classes"><span class="content">Conformance Classes</span><a class="self-link" href="#conformance-classes"></a></h3>
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-user-agent">conformant user agent<a class="self-link" href="#conformant-user-agent"></a></dfn> must implement all the requirements
    listed in this specification that are applicable to user agents.</p>
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-server">conformant server<a class="self-link" href="#conformant-server"></a></dfn> must implement all the requirements listed
    in this specification that are applicable to servers.</p>
  <h2 class="no-num heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="indexlist">
   <li><a href="#conformant-server">conformant server</a><span>, in §Unnumbered section</span>
   <li><a href="#conformant-user-agent">conformant user agent</a><span>, in §Unnumbered section</span>
  </ul>
  <h2 class="no-num heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-origin"><a class="self-link" href="#biblio-origin"></a>[ORIGIN]
   <dd>A. Barth. <a href="https://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>. December 2011. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6454">https://tools.ietf.org/html/rfc6454</a>
   <dt id="biblio-rfc2119"><a class="self-link" href="#biblio-rfc2119"></a>[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
  </dl>
 </body>
</html>